h1. APNS

a gem for the Apple Push Notification Service.

h2. Install

gem sources -a http://gems.github.com
    
sudo gem install jpoz-apns


h2. Setup:

Set what host, port, pem file and password on the APNS class:

<pre>
  <code>
    APNS.host = 'gateway.push.apple.com' 
    # gateway.sandbox.push.apple.com is default

    APNS.pem  = '/path/to/pem/file'
    APNS.pass = 'secret'
    # openssl pkcs12 -in cert.p12 -out cert.pem -nodes -clcerts
    
    APNS.port = 2195 
    # this is also the default. Shouldn't ever have to set this, but just in case Apple goes crazy, you can.
  </code>
</pre>

h2. Example:

Then to send a push notification you can either just send a string as the alert or give it a hash for the alert, badge and sound.

<pre>
  <code>
    device_token = '123abc456def'

    APNS.send_notification(device_token, 'Hello iPhone!' )

    APNS.send_notification(device_token, :alert => 'Hello iPhone!', :badge => 1, :sound => 'default')
  </code>
</pre>

h2. Send other info along with aps

You can send other application specific information as well.

<pre>
  <code>
    APNS.send_notification(device_token, :alert => 'Hello iPhone!', :badge => 1, :sound => 'default',
                                         :other => {:sent => 'with apns gem'})
  </code>
</pre>

This will add the other hash to the same level as the aps hash:

<pre>
  <code>
    {"aps":{"alert":"Hello iPhone!","badge":1,"sound":"default"},"sent":"with apns gem"}
  </code>
</pre>


h2. Getting your iPhone's device token

After you setup push notification for your application with Apple. You need to ask Apple for you application specific device token.

ApplicationAppDelegate.m
<pre>
  <code>
    - (BOOL)application:(UIApplication *)application 
    didFinishLaunchingWithOptions:(NSDictionary *)launchOptions 
    {
    [[UIApplication sharedApplication] registerForRemoteNotificationTypes:(UIRemoteNotificationTypeAlert | UIRemoteNotificationTypeSound | UIRemoteNotificationTypeBadge)];
    }
    
    - (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken {
      NSLog(@"deviceToken: %@", deviceToken);
    }
  </code>
</pre>
    


